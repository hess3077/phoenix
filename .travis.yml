language: php
php:
  - '7.1'

env:
  global:
    - GITHUB_REPO: "hess3077/phoenix"
    - secure: "SfKnd2q/Pr3oBfgf8lZNGhVa1K48AkcMFO3tJp/N6JgMyJtEfvNoj23+B6XBApfY+kr9bgOXve6Kz6Rp+q/6dvufSU8cdLBxXmIaZSvoprZr0+lCUnc0zxTzIHrW9ouciRarOuag5YWwH5PSO23XsAFhK4DS0vuFJBILQBdCmgTVXdqFaPABfm9b5I5Idgq4qua4ZjuNx8QkYnLKaSNsqurWHg8nyn5aGWKPMJwCRxtXgGJVVOUFvL/L1JjqcU7zgwGrpnQ3KFQ8gr+QRPtRMXItGYXcHTGz6jf78VF+PeP5M57vcTxLjW1awohLCjASE1816gzL7mTaKirk+K3Ztk5hdqrQQc1rIKX+ojJkaaisf3rqI//f5ZejQktwDN8JLNNUIMnFQi8AMQd9ZD0IILXyehD+lCrt+POmZoidjFPuO6RPA0vTrA2IHDsCoukyJ8k4tMbixBGqvPpsa78BbLQfBDmGjT60L92zSz5NaKRfTB97BrThfEeJr7OrhouFgcH6cgqFNJoXCm2Oaj7hBYpppWJazk/2jI2axSbBwcm1iLXAe7cdDtxREvbGC/pIi06dkvFiSnaNCDlrD1UqgqXAr2r1rw43XYOb/wYpyowC1deZ9BV8/cJhEiXgPVrn5DZq0ORI5dj4K/3Pi95Gj7JPhbEIVry4grxsZHexylg="

addons:
  sonarcloud:
    organization: "hess3077-github" # the key of the org you chose at step #3
    token:
      secure: "Xe28gX2tsrgd7a8vYKJjG4oYd5cyyW70+VHb+7TJBWUQFcFjUTwfsxTGyhIdLjY6OswXFFSD2J2TW4ryMq3N6laTxQr1wiG8fVTobtV2NDi8ThE9TIkRBVYScx3lgLR0icP4y/+W7uzyAfwmKYiVZtmyzUVmsQ03rW1j9yE4kCFvAzxMEW8/jO6S3408OKYB3DxOMvZcpx45WhQuB/danSq0AH+2CHRNnfmLdQpO3tcZEMkbuVgTAd5Vs682d++4F90J1EyEs6/DZNib5vrLlhsU5Dzh7Ml89jD/Cw0tri7mXRc44xjpbBKglL+67QBfighzwZDMhl34NRr19+c/UyybZyE/PAs3bfAxMd+SpgRTWL4hFMuZHSkkzE/QGQ5AdwzcB26BILdUShge1XoVOw6SfpJdJ0cCxH/9ufeT1Ot061W3YWw5HYO9y7Mm2U8szzfaRpUWH4JvSRstB1vOpDOydkGdOGnGFbnok9Pq0Fd2eU6sWbA+XwxWiV0cNRtyRr31EsdHIcn7o+kzzQe8MZB9XUXCb4TMIozSQjCUvzmk1ykqODAgN7re41X4iGXw/oeEaWTN4QsL2GFG7AWHgvuEBjLFXlFd7PVrNef2II8m3mdw9hgS7ySRP+6Hs5gQXOzus///WZHozDq+2hM8P4MN6Rw2WTU7qi/PnLaEbwQ=" # encrypted value of your token

script:
   - composer install
   - vendor/phpunit/phpunit/phpunit
   - sonar-scanner

before_script:
  - cp .env.test .env
  - composer install --no-progress
after_success:
  - vendor/bin/couscous travis-auto-deploy

notifications:
  irc:
    template:
      - "%{repository_slug}#%{build_number} (%{branch} - %{commit} : %{author}): %{message}"
      - "Change view : %{compare_url}"
      - "Build details : %{build_url}"
  email:
    recipients:
      - hess.website@gmail.com
    on_success: change
    on_failure: always
  slack:
    template:
      - "Build <%{build_url}|#%{build_number}: %{commit_subject}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} by %{author} %{result} in %{duration}"
    rooms:
      - hess-kn:FsAjzGENr3KPZr8p6TC7dDVV#app-backend-center