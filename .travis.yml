language: php
php:
  - '7.1'

env:
  global:
    - GITHUB_REPO: "hess3077/phoenix"
    - secure: "SfKnd2q/Pr3oBfgf8lZNGhVa1K48AkcMFO3tJp/N6JgMyJtEfvNoj23+B6XBApfY+kr9bgOXve6Kz6Rp+q/6dvufSU8cdLBxXmIaZSvoprZr0+lCUnc0zxTzIHrW9ouciRarOuag5YWwH5PSO23XsAFhK4DS0vuFJBILQBdCmgTVXdqFaPABfm9b5I5Idgq4qua4ZjuNx8QkYnLKaSNsqurWHg8nyn5aGWKPMJwCRxtXgGJVVOUFvL/L1JjqcU7zgwGrpnQ3KFQ8gr+QRPtRMXItGYXcHTGz6jf78VF+PeP5M57vcTxLjW1awohLCjASE1816gzL7mTaKirk+K3Ztk5hdqrQQc1rIKX+ojJkaaisf3rqI//f5ZejQktwDN8JLNNUIMnFQi8AMQd9ZD0IILXyehD+lCrt+POmZoidjFPuO6RPA0vTrA2IHDsCoukyJ8k4tMbixBGqvPpsa78BbLQfBDmGjT60L92zSz5NaKRfTB97BrThfEeJr7OrhouFgcH6cgqFNJoXCm2Oaj7hBYpppWJazk/2jI2axSbBwcm1iLXAe7cdDtxREvbGC/pIi06dkvFiSnaNCDlrD1UqgqXAr2r1rw43XYOb/wYpyowC1deZ9BV8/cJhEiXgPVrn5DZq0ORI5dj4K/3Pi95Gj7JPhbEIVry4grxsZHexylg="

addons:
  sonarcloud:
    organization: "hess3077-github" # the key of the org you chose at step #3
    token:
      secure: "VkPIi5BjfLJZ1G6yinvJrPZA23Phzk8s/rf1GmabHLm7gG/CuXXQycCfH0zvxNHTzippaqpI9H0iZTSQ3ydmyBEsMHS2lQ6Tlpg0RECmIOq7euLBH9iYEAz9ecaXMPg4ZZsaMtpOJVUngNtr/Fswqu2WbHCXF3wJjAPWe6BZAickihx/ybsQKGD0owP+X9Zda0kU6ywtXyVgOC9aa2NNvfsGLBZxLVAM48gMbQfgn9aS7btMc1QoUjUaCmdkTpUcgO6ODJNHlmTEqZpRGKnc9qcyZZ+520dS3xu4Brzm4NhLyLoeQwf8L7eqzVDyDV/yhXAR0JXbPPrLXCDa4tZafAxofAFBNtBC52GyLfcTPGZXLmEO6if8eFUGnwL6WTUWQzJBXNb4b78ELraL5Szwsc0+dQ3d/KoBPhcIJ3S6wbxLpl9VxmHZnYxCBouv8wk3hFiLeEKZ0q/pBNCa/2Kjzj8UgbRfAUPqbqjRbZfVxzpMh//lknfCPXGxLPlCoP3ZnP7SCmEnxLeJ2V5gvN3KK9SySlOB4xMovt4ldmA/bfkvLDihGOOqCq2+8IAvNjPh03F9evIhKB8I8G++L/Sje67xk6pDm50pWv9RjfN1K6/kqEs7C6Vh434C04RSqzbZITVz/NcHuDRoUVJSUkeyP49kjv13xYNxvYhibaEfezc=" # encrypted value of your token

script:
   - composer install
   - vendor/phpunit/phpunit/phpunit
   - sonar-scanner

before_script:
  - cp .env.test .env
  - composer install --no-progress
after_success:
  - vendor/bin/couscous travis-auto-deploy

notifications:
  irc:
    template:
      - "%{repository_slug}#%{build_number} (%{branch} - %{commit} : %{author}): %{message}"
      - "Change view : %{compare_url}"
      - "Build details : %{build_url}"
  email:
    recipients:
      - hess.website@gmail.com
    on_success: change
    on_failure: always
  slack:
    template:
      - "Build <%{build_url}|#%{build_number}: %{commit_subject}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} by %{author} %{result} in %{duration}"
    rooms:
      - hess-kn:FsAjzGENr3KPZr8p6TC7dDVV#app-backend-center
